<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>üîå Prueba de WebSockets - PetLink</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 20px;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
    }

    h1 {
      text-align: center;
      color: white;
      margin-bottom: 30px;
    }

    .status {
      background: white;
      padding: 20px;
      border-radius: 15px;
      margin-bottom: 20px;
      box-shadow: 0 5px 20px rgba(0,0,0,0.2);
    }

    .status.connected {
      border-left: 5px solid #28a745;
    }

    .status.disconnected {
      border-left: 5px solid #dc3545;
    }

    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 20px;
      margin-bottom: 20px;
    }

    .card {
      background: white;
      padding: 25px;
      border-radius: 15px;
      box-shadow: 0 5px 20px rgba(0,0,0,0.2);
    }

    .card h2 {
      color: #667eea;
      margin-bottom: 15px;
      font-size: 1.3em;
    }

    button {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      padding: 12px 25px;
      border-radius: 8px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      width: 100%;
      margin-top: 10px;
      transition: transform 0.2s;
    }

    button:hover {
      transform: translateY(-2px);
    }

    button:active {
      transform: translateY(0);
    }

    .log {
      background: white;
      padding: 20px;
      border-radius: 15px;
      box-shadow: 0 5px 20px rgba(0,0,0,0.2);
      max-height: 400px;
      overflow-y: auto;
    }

    .log h2 {
      color: #667eea;
      margin-bottom: 15px;
    }

    .log-entry {
      padding: 10px;
      margin-bottom: 8px;
      border-radius: 5px;
      font-size: 13px;
      border-left: 3px solid #667eea;
      background: #f8f9fa;
    }

    .log-entry.donation {
      border-left-color: #28a745;
      background: #d4edda;
    }

    .log-entry.need {
      border-left-color: #ffc107;
      background: #fff3cd;
    }

    .log-entry.urgent {
      border-left-color: #dc3545;
      background: #f8d7da;
    }

    .log-entry.appointment {
      border-left-color: #17a2b8;
      background: #d1ecf1;
    }

    .timestamp {
      font-size: 11px;
      color: #666;
      margin-top: 5px;
    }

    .badge {
      display: inline-block;
      padding: 4px 10px;
      border-radius: 12px;
      font-size: 12px;
      font-weight: 600;
      margin-left: 10px;
    }

    .badge.success {
      background: #28a745;
      color: white;
    }

    .badge.danger {
      background: #dc3545;
      color: white;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>üîå Prueba de WebSockets - PetLink</h1>

    <!-- Estado de conexi√≥n -->
    <div class="status disconnected" id="status">
      <strong>Estado:</strong> <span id="connection-status">Desconectado</span>
      <span class="badge danger" id="users-count">0 usuarios</span>
      <br>
      <small id="socket-id">ID: No conectado</small>
    </div>

    <!-- Botones de prueba -->
    <div class="grid">
      <!-- Donaciones -->
      <div class="card">
        <h2>üí∞ Donaciones</h2>
        <p>Simular una nueva donaci√≥n</p>
        <button onclick="sendDonation()">Enviar Donaci√≥n</button>
      </div>

      <!-- Necesidades -->
      <div class="card">
        <h2>üÜò Necesidades</h2>
        <p>Simular una nueva necesidad</p>
        <button onclick="sendNeed()">Crear Necesidad</button>
        <button onclick="sendUrgentNeed()" style="background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);">Necesidad Urgente ‚ö†Ô∏è</button>
      </div>

      <!-- Citas -->
      <div class="card">
        <h2>üìÖ Citas</h2>
        <p>Simular nueva cita</p>
        <button onclick="sendAppointment()">Agendar Cita</button>
      </div>

      <!-- Compras -->
      <div class="card">
        <h2>üéÅ Accesorios</h2>
        <p>Simular compra de accesorio</p>
        <button onclick="sendPurchase()">Comprar Accesorio</button>
      </div>
    </div>

    <!-- Log de eventos -->
    <div class="log">
      <h2>üìã Log de Eventos en Tiempo Real</h2>
      <div id="log-container">
        <p style="color: #999;">Esperando eventos...</p>
      </div>
    </div>
  </div>

  <!-- Socket.IO Client -->
  <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
  
  <script>
    // Conectar al servidor Socket.IO
    const socket = io('http://localhost:5050');

    // ============================================
    // üîå EVENTOS DE CONEXI√ìN
    // ============================================

    socket.on('connect', () => {
      console.log('‚úÖ Conectado al servidor');
      document.getElementById('status').className = 'status connected';
      document.getElementById('connection-status').textContent = 'Conectado';
      document.getElementById('socket-id').textContent = 'ID: ' + socket.id;
      addLog('‚úÖ Conectado al servidor', 'system');
    });

    socket.on('disconnect', () => {
      console.log('‚ùå Desconectado del servidor');
      document.getElementById('status').className = 'status disconnected';
      document.getElementById('connection-status').textContent = 'Desconectado';
      addLog('‚ùå Desconectado del servidor', 'system');
    });

    socket.on('welcome', (data) => {
      console.log('üëã Mensaje de bienvenida:', data);
      addLog(data.message, 'system');
    });

    socket.on('users-count', (data) => {
      document.getElementById('users-count').textContent = data.count + ' usuarios';
    });

    // ============================================
    // üì¢ EVENTOS DE NOTIFICACIONES
    // ============================================

    socket.on('donation-created', (data) => {
      console.log('üí∞ Nueva donaci√≥n:', data);
      addLog(`üí∞ ${data.message} - Monto: $${data.donation.amount}`, 'donation');
    });

    socket.on('need-created', (data) => {
      console.log('üÜò Nueva necesidad:', data);
      addLog(`üÜò ${data.message} - ${data.need.description}`, 'need');
    });

    socket.on('urgent-need-alert', (data) => {
      console.log('‚ö†Ô∏è NECESIDAD URGENTE:', data);
      addLog(`‚ö†Ô∏è ${data.message} - ${data.need.description}`, 'urgent');
    });

    socket.on('appointment-created', (data) => {
      console.log('üìÖ Nueva cita:', data);
      addLog(`üìÖ ${data.message} - ${data.appointment.date}`, 'appointment');
    });

    socket.on('purchase-notification', (data) => {
      console.log('üéÅ Nueva compra:', data);
      addLog(`üéÅ ${data.message} - ${data.purchase.item}`, 'system');
    });

    // ============================================
    // üì§ FUNCIONES PARA ENVIAR EVENTOS
    // ============================================

    function sendDonation() {
      const donation = {
        amount: Math.floor(Math.random() * 100000) + 10000,
        dogName: 'Max',
        donorName: 'Juan P√©rez'
      };
      socket.emit('new-donation', donation);
      addLog('üì§ Donaci√≥n enviada: $' + donation.amount, 'system');
    }

    function sendNeed() {
      const need = {
        description: 'Vacuna antirr√°bica',
        dogName: 'Luna',
        cost: 50000
      };
      socket.emit('new-need', need);
      addLog('üì§ Necesidad enviada: ' + need.description, 'system');
    }

    function sendUrgentNeed() {
      const need = {
        description: 'üÜò Cirug√≠a de emergencia',
        dogName: 'Rocky',
        cost: 500000,
        urgent: true
      };
      socket.emit('urgent-need', need);
      addLog('üì§ Necesidad URGENTE enviada: ' + need.description, 'urgent');
    }

    function sendAppointment() {
      const appointment = {
        date: new Date().toLocaleDateString(),
        time: '10:00 AM',
        dogName: 'Bella',
        type: 'Revisi√≥n general'
      };
      socket.emit('new-appointment', appointment);
      addLog('üì§ Cita enviada: ' + appointment.date, 'system');
    }

    function sendPurchase() {
      const purchase = {
        item: 'Collar de cuero',
        dogName: 'Max',
        amount: 35000
      };
      socket.emit('accessory-purchased', purchase);
      addLog('üì§ Compra enviada: ' + purchase.item, 'system');
    }

    // ============================================
    // üìã FUNCI√ìN PARA AGREGAR AL LOG
    // ============================================

    function addLog(message, type = 'system') {
      const logContainer = document.getElementById('log-container');
      
      // Limpiar mensaje inicial
      if (logContainer.children.length === 1 && logContainer.children[0].tagName === 'P') {
        logContainer.innerHTML = '';
      }
      
      const entry = document.createElement('div');
      entry.className = 'log-entry ' + type;
      entry.innerHTML = `
        <strong>${message}</strong>
        <div class="timestamp">${new Date().toLocaleTimeString()}</div>
      `;
      
      logContainer.insertBefore(entry, logContainer.firstChild);
      
      // Limitar a 20 entradas
      if (logContainer.children.length > 20) {
        logContainer.removeChild(logContainer.lastChild);
      }
    }
  </script>
</body>
</html>